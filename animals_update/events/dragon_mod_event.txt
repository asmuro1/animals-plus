#######dragon update
### event 198 - 

namespace = ani_plus

#### event 198 and 199 are created to prevent dragon character from changing culture
#### at the exception where an egg can become an adult
## event 198: on_action trigger, switch back to old culture if old is dragon
## event 199: exits only to avoid an infinite loop if old and new culture are both adult dragon

# event 198 - preventing dragon to change culture (race)
#               except for switch between dragon egg and adult dragon
character_event = {
    id = ani_plus.198

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_character_flag = ignore_next_dragon_conv }
    }

    immediate = {
        # had to do tests with a new character becaus engine did not let me do
        # any test on culture scope
        create_character = {
            culture = FROM
            female = random
        }

        if = {
            limit = {
                new_character = { # was dragon
                    culture_group = dragon_group
                }
                NAND = {          # not adult yet
                    new_character = {
                        culture = dragon_culture
                    }
                    ROOT = {
                        culture_group = dragon_group
                        is_adult = yes
                    }
                }
                NAND = {         # not at birth or game start
                    new_character = {
                        NOT = { culture = dragon_culture }
                    }
                    ROOT = {
                        culture = dragon_culture
                        is_adult = no
                    }
                }
            }
            set_character_flag = ignore_next_dragon_conv
            culture = FROM

            character_event = { id = ani_plus.199 days = 1}
        }

        new_character = {
            death = yes
        }
    }
}

# event 199
character_event = {
    id = ani_plus.199

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        clr_character_flag = ignore_next_dragon_conv
    }
}

#### event 200 to 201: religious event force religion setting
## event 200: setting holy site randomly (on game start, event if random always choose the same provinces)
## event 201: setting character and province in game start by
#                   forcing dragon religion
#                   setting egg culture for dragon egg
#                   giving adult dragon their flag
## event 202: converting character on birth or culture change
## event 203: converting province culture on religion change


# event 200
character_event = {
    id = ani_plus.200

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_global_flag = dragon_holy_sites_set }
    }

    immediate = {
        set_black_dragon_holy_site_effect = yes
        set_white_dragon_holy_site_effect = yes
        set_red_dragon_holy_site_effect = yes
        set_blue_dragon_holy_site_effect = yes
        set_yellow_dragon_holy_site_effect = yes
    }

    after = {
        set_global_flag = dragon_holy_sites_set
    }
}

# event 201
character_event = {
    id = ani_plus.201

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        any_character = {
            limit = {
                culture_group = dragon_group
                can_change_religion = yes
            }
            religion = Dragon_religion
            dragon_get_dragon_egg_culture_if_child_effect = yes
            dragon_get_true_adult_effect = yes
        }
        any_province = {
            limit = {
                culture_group = dragon_group
            }
            religion = Dragon_religion
        }
    }
}

# event 202
character_event = {
    id = ani_plus.202

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        culture_group = dragon_group
        can_change_religion = yes
        NOT = { religion = Dragon_religion }
    }

    immediate = {
        religion = Dragon_religion
    }
}

# event 203
province_event = {
    id = ani_plus.203

    hide_window = yes
    
    trigger = {
        culture_group = dragon_group
        NOT = {
            religion = Dragon_religion
        }
    }

    mean_time_to_happen = {
        months = 1
    }

    immediate = {
        if = {
            limit = {
                holder_scope = {
                    culture_group = dragon_group
                }
            }

            religion = Dragon_religion
        }
        else = {
            culture = holder_scope
        }
    }
}

# event 204: force looting from a baronny title
province_event = {
    id = ani_plus.204

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ani_204

    trigger = {
        culture_group = dragon_group
        holder_scope = {
            culture_group = dragon_group
        }

        county = {
            is_occupied = no
            any_de_jure_vassal_title = {
                OR = {
                    holding_type = castle
                    holding_type = city
                    holding_type = temple
                }
            }
        }
    }

    mean_time_to_happen = {
        months = 2

        modifier = {
            factor = 100

            holder_scope = {
                culture = dragon_culture
            }
        }
    }

    option = {
        name = OPT_ani_204

        county = {
            show_scope_change = no
            random_direct_de_jure_vassal_title = {
                limit = {
                    OR = {
                        holding_type = castle
                        holding_type = city
                        holding_type = temple
                    }
                }

                if = {
                    limit = {
                        has_any_building = yes
                    }

                    destroy_random_building = yes
                }
                else = {
                    destroy_settlement = yes
                }
            }

            holder_scope = {
                wealth = 200
            }
        }
    }
}

#### event 205 to 220: dragon lifetime events
## event 205: hidden event for adulthood (to show parent player)
## event 206: notification for culture change
#               and removing education trait (if conclave is disable)
#                   as education trait will be added after passing the 5 trials
## event 207: trial tombola for dragon
## event 208-209: snow trial
## event 210-211: fire trial
## event 212-213: water trial
## event 214-215: sand trial
## event 216-217: poison trial
## event 218: conclusion (give education trait and intelligence trait)
## event 219: event to prevent dragon egg from hatching
## event 220: player notification for its unborn child death

# event 205
character_event = {
    id = ani_plus.205

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        culture = dragon_culture
    }

    immediate = {
        if = {
            limit = {
                father = {
                    ai = no
                }
            }

            father = {
                character_event = { id = ani_plus.206 }
            }
        }
        else_if = {
            limit = {
                mother = {
                    ai = no
                }
            }
            
            mother = {
                character_event = { id = ani_plus.206 }
            }
        }
        else = {
            character_event = { id = ani_plus.206 }
        }
    }
}

# event 206
character_event = {
    id = ani_plus.206

    is_triggered_only = yes

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council
    desc = {
        trigger = {
            NOT = { character = FROM }
        }
        text = DESCA_ANI_206
    }
    desc = {
        trigger = {
            character = FROM
        }
        text = DESCB_ANI_206
    }

    option = {
        name = {
            text = OPTA_ANI_206
            trigger = {
                NOT = { character = FROM }
            }
        }

        FROM = {
            #removing education trait if conclave DLC disabled
            hidden_tooltip = {
                generate_tooltip = no

                remove_trait = amateurish_plotter
                remove_trait = flamboyant_schemer
                remove_trait = intricate_webweaver
                remove_trait = elusive_shadow

                remove_trait = naive_appeaser
                remove_trait = underhanded_rogue
                remove_trait = charismatic_negotiator
                remove_trait = grey_eminence

                remove_trait = indulgent_wastrel
                remove_trait = thrifty_clerk
                remove_trait = fortune_builder
                remove_trait = midas_touched

                remove_trait = misguided_warrior
                remove_trait = tough_soldier
                remove_trait = skilled_tactician
                remove_trait = brilliant_strategist

                remove_trait = detached_priest
                remove_trait = martial_cleric
                remove_trait = scholarly_theologian
                remove_trait = mastermind_theologian
            }

            random_list = {
                1 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            has_character_flag = white_dragon_potential
                        }
                    }
                    
                    culture = white_dragon
                }
                1 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            has_character_flag = black_dragon_potential
                        }
                    }

                    culture = black_dragon
                }
                1 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            has_character_flag = blue_dragon_potential
                        }
                    }

                    culture = blue_dragon
                }
                1 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            has_character_flag = red_dragon_potential
                        }
                    }

                    culture = red_dragon
                }
                1 = {
                    modifier = {
                        factor = 0
                        NOT = {
                            has_character_flag = yellow_dragon_potential
                        }
                    }

                    culture = yellow_dragon
                }
            }
            clr_character_flag = white_dragon_potential
            clr_character_flag = black_dragon_potential
            clr_character_flag = blue_dragon_potential
            clr_character_flag = red_dragon_potential
            clr_character_flag = yellow_dragon_potential
        }
    }
}

# event 207
character_event = {
    id = ani_plus.207

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        culture_group = dragon_group
        NOT = { culture = dragon_culture } # not an egg
        NOT = { has_character_flag = is_true_dragon_adult }
        war = no
    }

    immediate = {
		if = {
			limit = {
				OR = { # has an education trait
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
					trait = indulgent_wastrel
					trait = thrifty_clerk
					trait = fortune_builder
					trait = midas_touched
					trait = naive_appeaser
					trait = underhanded_rogue
					trait = charismatic_negotiator
					trait = grey_eminence
					trait = detached_priest
					trait = martial_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
					trait = amateurish_plotter
					trait = flamboyant_schemer
					trait = intricate_webweaver
					trait = elusive_shadow
				}
			}
			set_character_flag = is_true_dragon_adult
			break = yes
		}

        random_list = {
            1 = { # snow trial
                trigger = {
                    NOT = {
                        has_character_flag = snow_trial_realized
                    }
                }
                set_character_flag = snow_trial_realized
                character_event = { id = ani_plus.208 }
            }
            1 = { # fire trial
                trigger = {
                    NOT = {
                        has_character_flag = fire_trial_realized
                    }
                }
                set_character_flag = fire_trial_realized
                character_event = { id = ani_plus.210 }
            }
            1 = { # water trial
                trigger = {
                    NOT = {
                        has_character_flag = water_trial_realized
                    }
                }
                set_character_flag = water_trial_realized
                character_event = { id = ani_plus.212 }
            }
            1 = { # sand trial
                trigger = {
                    NOT = {
                        has_character_flag = sand_trial_realized
                    }
                }
                set_character_flag = sand_trial_realized
                character_event = { id = ani_plus.214 }
            }
            1 = { # poison trial
                trigger = {
                    NOT = {
                        has_character_flag = poison_trial_realized
                    }
                }
                set_character_flag = poison_trial_realized
                character_event = { id = ani_plus.216 }
            }
            fallback  = { # all trials done
                if = {
                    limit = {
                        father = {
                            ai = no
                        }
                    }
                    father = {
                        character_event = { id = ani_plus.218 }
                    }
                }
                else_if = {
                    limit = {
                        mother = {
                            ai = no
                        }
                    }
                    mother = {
                        character_event = { id = ani_plus.218 }
                    }
                }
                else = {
                    character_event = { id = ani_plus.218 }
                }
            }
        }
    }
}

# event 208 - snow
character_event = {
    id = ani_plus.208

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_208

    option = {
        name = OPTA_ANI_208
        set_character_flag = dragon_snow_normal
        
        ai_chance = {
            factor = 10
            
            dragon_trial_choice_1_score = yes
        }
    }
    option = {
        name = OPTB_ANI_208
        set_character_flag = dragon_snow_hard

        ai_chance = {
            factor = 10

            dragon_trial_choice_2_score = yes
        }
    }
    option = {
        name = OPTC_ANI_208
        set_character_flag = dragon_snow_safe

        ai_chance = {
            factor = 10

            dragon_trial_choice_3_score = yes
        }
    }
    option = {
        name = OPTD_ANI_208
        set_character_flag = dragon_snow_all_for_all

        ai_chance = {
            factor = 10

            dragon_trial_choice_4_score = yes
        }
    }

    after = {
        hidden_tooltip = {
            random_list = {

                100 = {
                    trigger = {
                        NOT = {
                            has_character_flag = dragon_snow_safe
                        }
                    }
                    modifier = {
                        factor = 0.80
                        has_character_flag = dragon_snow_normal
                    }
                    modifier = {
                        factor = 1.5
                        learning = 5
						NOT = { learning = 10}
                    }
                    modifier = {
                        factor = 0.5
                        NAND = {
                            learning = 2
                            culture = white_dragon
                        }
                    }
                    modifier = {
                        factor = 1.25
                        trait = lustful
                    }
                    modifier = {
                        factor = 1.25
                        trait = slothful
                    }
                    modifier = {
                        factor = 1.5
                        trait = zealous
                    }
                    set_character_flag = dragon_snow_level_1
                }
                100 = {
                    trigger = {
                        NOT = {
                            has_character_flag = dragon_snow_all_for_all
                        }
                    }
                    modifier = {
                        factor = 0.80
                        has_character_flag = dragon_snow_normal
                    }
                    modifier = {
                        factor = 2
                        learning = 10
						NOT = { learning = 15}
                    }
                    modifier = {
                        factor = 0.5
                        NAND = {
                            learning = 5
                            culture = white_dragon
                        }
                    }
                    modifier = {
                        factor = 1.25
                        trait = envious
                    }
                    modifier = {
                        factor = 1.25
                        trait = proud
                    }
                    modifier = {
                        factor = 1.25
                        trait = zealous
                    }
                    set_character_flag = dragon_snow_level_2
                }
                100 = {
                    trigger = {
                        NOR = {
                            has_character_flag = dragon_snow_hard
                            has_character_flag = dragon_snow_all_for_all
                        }
                    }
                    modifier = {
                        factor = 2
                        learning = 15
						NOT = { learning = 20 }
                    }
                    modifier = {
                        factor = 0.5
                        NAND = {
                            learning = 10
                            culture = white_dragon
                        }
                    }
                    modifier = {
                        factor = 1.25
                        trait = chaste
                    }
                    modifier = {
                        factor = 1.5
                        trait = erudite
                    }
                    set_character_flag = dragon_snow_level_3
                }
                100 = {
                    trigger = {
                        NOR = {
                            has_character_flag = dragon_snow_normal
                            has_character_flag = dragon_snow_safe
                        }
                    }
                    modifier = {
                        factor = 2
                        learning = 20
                    }
                    modifier = {
                        factor = 0.5
                        NAND = {
                            learning = 15
                            culture = white_dragon
                        }
                    }
                    modifier = {
                        factor = 1.25
                        trait = humble
                    }
                    modifier = {
                        factor = 1.5
                        trait = erudite
                    }
                    set_character_flag = dragon_snow_level_4
                }
            }

            clr_character_flag = dragon_snow_normal
            clr_character_flag = dragon_snow_hard
            clr_character_flag = dragon_snow_all_for_all
            clr_character_flag = dragon_snow_safe

            character_event = { id = ani_plus.209 }
        }
    }
}

# event 209
character_event = {
    id = ani_plus.209

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_209

    option = {
        name = OPTA_ANI_209
        trigger = {
            has_character_flag = dragon_snow_level_1
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 1
            }
        }
    }
    option = {
        name = OPTB_ANI_209
        trigger = {
            has_character_flag = dragon_snow_level_2
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 2
            }
        }
        
    }
    option = {
        name = OPTC_ANI_209
        trigger = {
            has_character_flag = dragon_snow_level_3
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 3
            }
        }
    }
    option = {
        name = OPTD_ANI_209
        trigger = {
            has_character_flag = dragon_snow_level_4
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 4
            }
        }
    }
}

# event 210 - fire
character_event = {
    id = ani_plus.210

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_210

	# option has same localisation as the first event
    option = {
        name = OPTA_ANI_208
        set_character_flag = dragon_fire_normal
        
        ai_chance = {
            factor = 10
            
            dragon_trial_choice_1_score = yes
        }
    }
    option = {
        name = OPTB_ANI_208
        set_character_flag = dragon_fire_hard

        ai_chance = {
            factor = 10

            dragon_trial_choice_2_score = yes
        }
    }
    option = {
        name = OPTC_ANI_208
        set_character_flag = dragon_fire_safe

        ai_chance = {
            factor = 10

            dragon_trial_choice_3_score = yes
        }
    }
    option = {
        name = OPTD_ANI_208
        set_character_flag = dragon_fire_all_for_all

        ai_chance = {
            factor = 10

            dragon_trial_choice_4_score = yes
        }
    }

	after = {
		hidden_tooltip = {
			random_list = {

				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_fire_safe
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_fire_normal
					}
					modifier = {
						factor = 1.5
						martial = 5
						NOT = { martial = 10 } 
					}
					modifier = {
						factor = 0.5
						NAND = {
							martial = 2
							culture = red_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = chaste
					}
					modifier = {
						factor = 1.5
						trait = charitable
					}
					modifier = {
						factor = 4
						trait = gluttonous
					}
					modifier = {
						factor = 7
						trait = slothful
					}
					modifier = {
						factor = 1.25
						trait = deceitful
					}
					modifier = {
						factor = 1.1
						trait = shy
					}


					set_character_flag = dragon_fire_level_1
				}
				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_fire_all_for_all
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_fire_normal
					}
					modifier = {
						factor = 2
						martial = 10
						NOT = { martial = 15}
					}
					modifier = {
						factor = 0.5
						NAND = {
							martial = 5
							culture = red_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = gluttonous
					}
					modifier = {
						factor = 2
						trait = slothful
					}
					modifier = {
						factor = 3
						trait = shy
					}
					modifier = {
						factor = 2
						trait = content
					}
					modifier = {
						factor = 1.3
						trait = arbitrary
					}
					
					set_character_flag = dragon_fire_level_2
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_fire_hard
							has_character_flag = dragon_fire_all_for_all
						}
					}
					modifier = {
						factor = 2
						martial = 15
						NOT = { martial = 20 }
					}
					modifier = {
						factor = 0.5
						NAND = {
							martial = 10
							culture = red_dragon
						}
					}
					modifier = {
						factor = 2
						trait = content
					}
					modifier = {
						factor = 1.1
						trait = arbitrary
					}
					modifier = {
						factor = 3
						trait = wroth
					}
					modifier = {
						factor = 1.5
						trait = proud
					}
					modifier = {
						factor = 2
						trait = brave
					}
					modifier ={
						factor = 2
						trait = cruel
					}
					modifier = {
						factor = 1.3
						trait = stubborn
					}
					

					set_character_flag = dragon_fire_level_3
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_fire_normal
							has_character_flag = dragon_fire_safe
						}
					}
					modifier = {
						factor = 2
						martial = 20
					}
					modifier = {
						factor = 0.5
						NAND = {
							martial = 15
							culture = red_dragon
						}
					}
					modifier = {
						factor = 2
						trait = wroth
					}
					modifier = {
						factor = 3
						trait = brave
					}
					modifier = {
						factor = 1.5
						trait = cruel
					}
					modifier = {
						factor = 1.1
						trait = diligent
					}

					set_character_flag = dragon_fire_level_4
                }
            }

            clr_character_flag = dragon_fire_normal
            clr_character_flag = dragon_fire_hard
            clr_character_flag = dragon_fire_all_for_all
            clr_character_flag = dragon_fire_safe

            character_event = { id = ani_plus.211 }
        }
    }
}

# event 211 - same loc as event 209
character_event = {
    id = ani_plus.211

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_209

    option = {
        name = OPTA_ANI_209
        trigger = {
            has_character_flag = dragon_fire_level_1
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 1
            }
        }
    }
    option = {
        name = OPTB_ANI_209
        trigger = {
            has_character_flag = dragon_fire_level_2
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 2
            }
        }
        
    }
    option = {
        name = OPTC_ANI_209
        trigger = {
            has_character_flag = dragon_fire_level_3
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 3
            }
        }
    }
    option = {
        name = OPTD_ANI_209
        trigger = {
            has_character_flag = dragon_fire_level_4
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 4
            }
        }
    }
}

# event 212 - water
character_event = {
    id = ani_plus.212

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_212

	# option has same localisation as the first event
    option = {
        name = OPTA_ANI_208
        set_character_flag = dragon_water_normal
        
        ai_chance = {
            factor = 10
            
            dragon_trial_choice_1_score = yes
        }
    }
    option = {
        name = OPTB_ANI_208
        set_character_flag = dragon_water_hard

        ai_chance = {
            factor = 10

            dragon_trial_choice_2_score = yes
        }
    }
    option = {
        name = OPTC_ANI_208
        set_character_flag = dragon_water_safe

        ai_chance = {
            factor = 10

            dragon_trial_choice_3_score = yes
        }
    }
    option = {
        name = OPTD_ANI_208
        set_character_flag = dragon_water_all_for_all

        ai_chance = {
            factor = 10

            dragon_trial_choice_4_score = yes
        }
    }

	after = {
		hidden_tooltip = {
			random_list = {

				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_water_safe
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_water_normal
					}
					modifier = {
						factor = 1.5
						diplomacy = 5
						NOT = { diplomacy = 10 } 
					}
					modifier = {
						factor = 0.5
						NAND = {
							diplomacy = 2
							culture = blue_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = chaste
					}
					modifier = {
						factor = 2
						trait = greedy
					}
					modifier = {
						factor = 1.5
						trait = envious
					}
					modifier = {
						factor = 2
						trait  = proud
					}


					set_character_flag = dragon_water_level_1
				}
				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_water_all_for_all
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_water_normal
					}
					modifier = {
						factor = 2
						diplomacy = 10
                        NOT = { diplomacy = 15 }
					}
                    modifier = {
                        factor = 0.5
						NAND = {
							diplomacy = 10
							culture = blue_dragon
						}
                    }
					modifier = {
						factor = 2
						trait = lustful
					}
					modifier = {
						factor = 1.5
						trait = gluttonous
					}
					modifier = {
						factor = 1.5
						trait = envious
					}
					modifier = {
						factor = 2
						trait = humble
					}
					
					set_character_flag = dragon_water_level_2
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_water_hard
							has_character_flag = dragon_water_all_for_all
						}
					}
					modifier = {
						factor = 2
						diplomacy = 15
						NOT = { diplomacy = 20 }
					}
					modifier = {
						factor = 0.5
						NAND = {
							diplomacy = 10
							culture = blue_dragon
						}
					}
					modifier = {
						factor = 2
						trait = temperate
					}
					modifier = {
						factor = 1.5
						trait = patient
					}
					modifier = {
						factor = 1.25
						trait = kind
					}

					set_character_flag = dragon_water_level_3
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_water_normal
							has_character_flag = dragon_water_safe
						}
					}
					modifier = {
						factor = 2
						diplomacy = 20
					}
					modifier = {
						factor = 0.5
						NAND = {
							diplomacy = 15
							culture = blue_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = charitable
					}
					modifier = {
						factor = 1.5
						trait = patient
					}
					modifier = {
						factor = 1.75
						trait = kind
					}

					set_character_flag = dragon_water_level_4
                }
            }

            clr_character_flag = dragon_water_normal
            clr_character_flag = dragon_water_hard
            clr_character_flag = dragon_water_all_for_all
            clr_character_flag = dragon_water_safe

            character_event = { id = ani_plus.213 }
        }
    }
}

# event 213 - same loc as event 209
character_event = {
	id = ani_plus.213

	is_triggered_only = yes
	border = GFX_event_normal_frame_diplomacy
	picture = GFX_evt_council

	desc = DESC_ANI_209

	option = {
		name = OPTA_ANI_209
		trigger = {
			has_character_flag = dragon_water_level_1
		}

		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 1
			}
		}
	}
	option = {
		name = OPTB_ANI_209
		trigger = {
			has_character_flag = dragon_water_level_2
		}
		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 2
			}
		}
	}
	option = {
		name = OPTC_ANI_209
		trigger = {
			has_character_flag = dragon_water_level_3
		}

		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 3
			}
		}
	}
	option = {
		name = OPTD_ANI_209
		trigger = {
			has_character_flag = dragon_water_level_4
		}
		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 4
			}
		}
	}
}

# event 214 - sand
character_event = {
    id = ani_plus.214

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_214

	# option has same localisation as the first event
    option = {
        name = OPTA_ANI_208
        set_character_flag = dragon_sand_normal
        
        ai_chance = {
            factor = 10
            
            dragon_trial_choice_1_score = yes
        }
    }
    option = {
        name = OPTB_ANI_208
        set_character_flag = dragon_sand_hard

        ai_chance = {
            factor = 10

            dragon_trial_choice_2_score = yes
        }
    }
    option = {
        name = OPTC_ANI_208
        set_character_flag = dragon_sand_safe

        ai_chance = {
            factor = 10

            dragon_trial_choice_3_score = yes
        }
    }
    option = {
        name = OPTD_ANI_208
        set_character_flag = dragon_sand_all_for_all

        ai_chance = {
            factor = 10

            dragon_trial_choice_4_score = yes
        }
    }

	after = {
		hidden_tooltip = {
			random_list = {

				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_sand_safe
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_sand_normal
					}
					modifier = {
						factor = 1.5
						stewardship = 5
						NOT = { stewardship = 10 } 
					}
					modifier = {
						factor = 0.5
						NAND = {
							stewardship = 2
							culture = yellow_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = arbitrary
					}
					modifier = {
						factor = 2.5
						trait = cynical
					}
					modifier = {
						factor = 3
						trait = craven
					}
					modifier = {
						factor = 2
						trait = content
					}
					modifier = {
						factor = 4
						trait = charitable
					}
					modifier = {
						factor = 1.5
						trait = slothful
					}

					set_character_flag = dragon_sand_level_1
				}
				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_sand_all_for_all
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_sand_normal
					}
					modifier = {
						factor = 1.5
						stewardship = 10
						NOT = { stewardship = 15 } 
					}
					modifier = {
						factor = 0.5
						NAND = {
							stewardship = 5
							culture = yellow_dragon
						}
					}
					modifier = {
						factor = 2
						trait = arbitrary
					}
					modifier = {
						factor = 1.2
						trait = gregarious
					}
					modifier = {
						factor = 2
						trait = cruel
					}
					modifier = {
						factor = 2
						trait = content
					}
					modifier = {
						factor = 2
						trait = slothful
					}
					modifier = {
						factor = 1.5
						trait = wroth
					}
					
					set_character_flag = dragon_sand_level_2
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_sand_hard
							has_character_flag = dragon_sand_all_for_all
						}
					}
					modifier = {
						factor = 2
						stewardship = 15
						NOT = { stewardship = 20 }
					}
					modifier = {
						factor = 0.5
						NAND = {
							stewardship = 10
							culture = yellow_dragon
						}
					}
					modifier = {
						factor = 2
						trait = just
					}
					modifier = {
						factor = 1.2
						trait = gregarious
					}
					modifier = {
						factor = 2
						trait = ambitious
					}
					modifier = {
						factor = 2
						trait = diligent
					}
					modifier = {
						factor = 1.5
						trait = patient
					}

					set_character_flag = dragon_sand_level_3
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_sand_normal
							has_character_flag = dragon_sand_safe
						}
					}
					modifier = {
						factor = 2
						stewardship = 20
					}
					modifier = {
						factor = 0.5
						NAND = {
							stewardship = 15
							culture = yellow_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = just
					}
					modifier = {
						factor = 1.2
						trait = gregarious
					}
					modifier = {
						factor = 4
						trait = greedy
					}
					modifier = {
						factor = 1.4
						trait = diligent
					}

					set_character_flag = dragon_sand_level_4
                }
            }

            clr_character_flag = dragon_sand_normal
            clr_character_flag = dragon_sand_hard
            clr_character_flag = dragon_sand_all_for_all
            clr_character_flag = dragon_sand_safe

            character_event = { id = ani_plus.215 }
        }
    }
}

# event 215 - same loc as event 209
character_event = {
    id = ani_plus.215

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_209

    option = {
        name = OPTA_ANI_209
        trigger = {
            has_character_flag = dragon_sand_level_1
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 1
            }
        }
    }
    option = {
        name = OPTB_ANI_209
        trigger = {
            has_character_flag = dragon_sand_level_2
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 2
            }
        }
        
    }
    option = {
        name = OPTC_ANI_209
        trigger = {
            has_character_flag = dragon_sand_level_3
        }

        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 3
            }
        }
    }
    option = {
        name = OPTD_ANI_209
        trigger = {
            has_character_flag = dragon_sand_level_4
        }
        hidden_tooltip = {
            change_variable = {
                which = dragon_education_score
                value = 4
            }
        }
    }
}

# event 216 - poison
character_event = {
    id = ani_plus.216

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    desc = DESC_ANI_216

	# option has same localisation as the first event
    option = {
        name = OPTA_ANI_208
        set_character_flag = dragon_poison_normal
        
        ai_chance = {
            factor = 10
            
            dragon_trial_choice_1_score = yes
        }
    }
    option = {
        name = OPTB_ANI_208
        set_character_flag = dragon_poison_hard

        ai_chance = {
            factor = 10

            dragon_trial_choice_2_score = yes
        }
    }
    option = {
        name = OPTC_ANI_208
        set_character_flag = dragon_poison_safe

        ai_chance = {
            factor = 10

            dragon_trial_choice_3_score = yes
        }
    }
    option = {
        name = OPTD_ANI_208
        set_character_flag = dragon_poison_all_for_all

        ai_chance = {
            factor = 10

            dragon_trial_choice_4_score = yes
        }
    }

	after = {
		hidden_tooltip = {
			random_list = {

				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_poison_safe
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_poison_normal
					}
					modifier = {
						factor = 1.5
						intrigue = 5
						NOT = { intrigue = 10 } 
					}
					modifier = {
						factor = 0.5
						NAND = {
							intrigue = 2
							culture = black_dragon
						}
					}
					modifier = {
						factor = 3
						trait = trusting
					}
					modifier = {
						factor = 1.5
						trait = honest
					}
					modifier = {
						factor = 2
						trait = cynical
					}
					modifier = {
						factor = 2
						trait = craven
					}


					set_character_flag = dragon_poison_level_1
				}
				100 = {
					trigger = {
						NOT = {
							has_character_flag = dragon_poison_all_for_all
						}
					}
					modifier = {
						factor = 0.80
						has_character_flag = dragon_poison_normal
					}
					modifier = {
						factor = 2
						intrigue = 10
                        NOT = { intrigue = 15 }
					}
                    modifier = {
                        factor = 0.5
						NAND = {
							intrigue = 10
							culture = black_dragon
						}
                    }
					modifier = {
						factor = 2
						trait = stubborn
					}
					modifier = {
						factor = 1.25
						trait = shy
					}
					modifier = {
						factor = 1.25
						trait = craven
					}
					
					set_character_flag = dragon_poison_level_2
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_poison_hard
							has_character_flag = dragon_poison_all_for_all
						}
					}
					modifier = {
						factor = 2
						intrigue = 15
						NOT = { intrigue = 20 }
					}
					modifier = {
						factor = 0.5
						NAND = {
							intrigue = 10
							culture = black_dragon
						}
					}
					modifier = {
						factor = 2
						trait = zealous
					}
					modifier = {
						factor = 1.25
						trait = shy
					}
					modifier = {
						factor = 2
						trait = paranoid
					}
					modifier = {
						factor = 1.25
						trait = gregarious
					}
					modifier = {
						factor = 1.3
						trait = cruel
					}

					set_character_flag = dragon_poison_level_3
				}
				100 = {
					trigger = {
						NOR = {
							has_character_flag = dragon_poison_normal
							has_character_flag = dragon_poison_safe
						}
					}
					modifier = {
						factor = 2
						intrigue = 20
					}
					modifier = {
						factor = 0.5
						NAND = {
							intrigue = 15
							culture = black_dragon
						}
					}
					modifier = {
						factor = 1.5
						trait = paranoid
					}
					modifier = {
						factor = 2
						trait = gregarious
					}
					modifier = {
						factor = 1.5
						trait = deceitful
					}
					modifier = {
						factor = 1.25
						trait = brave
					}

					set_character_flag = dragon_poison_level_4
                }
            }

            clr_character_flag = dragon_poison_normal
            clr_character_flag = dragon_poison_hard
            clr_character_flag = dragon_poison_all_for_all
            clr_character_flag = dragon_poison_safe

            character_event = { id = ani_plus.217 }
        }
    }
}

# event 217 - same loc as event 209
character_event = {
	id = ani_plus.217

	is_triggered_only = yes
	border = GFX_event_normal_frame_diplomacy
	picture = GFX_evt_council

	desc = DESC_ANI_209

	option = {
		name = OPTA_ANI_209
		trigger = {
			has_character_flag = dragon_poison_level_1
		}

		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 1
			}
		}
	}
	option = {
		name = OPTB_ANI_209
		trigger = {
			has_character_flag = dragon_poison_level_2
		}
		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 2
			}
		}
	}
	option = {
		name = OPTC_ANI_209
		trigger = {
			has_character_flag = dragon_poison_level_3
		}

		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 3
			}
		}
	}
	option = {
		name = OPTD_ANI_209
		trigger = {
			has_character_flag = dragon_poison_level_4
		}
		hidden_tooltip = {
			change_variable = {
				which = dragon_education_score
				value = 4
			}
		}
	}
}

# event 218
character_event = {
    id = ani_plus.218

    is_triggered_only = yes
	border = GFX_event_normal_frame_diplomacy
	picture = GFX_evt_council

	desc = DESC_ANI_218

    immediate = {
        FROM = {
            set_character_flag = is_true_dragon_adult
    		add_dragon_university_score_effect = yes
        }
    }

	option = {
		name = OPT_ANI_218
		FROM = {
			trigger_switch = {
				on_trigger = culture
				black_dragon	= { set_black_dragon_education_effect = yes }
				white_dragon	= { set_white_dragon_education_effect = yes }
				blue_dragon		= { set_blue_dragon_education_effect = yes }
				yellow_dragon	= { set_yellow_dragon_education_effect = yes }
				red_dragon		= { set_red_dragon_education_effect = yes }
			}

			add_intelligence_trait_effect = yes
		}
	}

    after = {
        hidden_tooltip = {
            FROM = {
                # removing variable from save
                set_variable = {
                    which = dragon_education_score
                    value = 0
                }
				# removing trial flags
				clr_character_flag = snow_trial_realized
				clr_character_flag = fire_trial_realized
				clr_character_flag = water_trial_realized
				clr_character_flag = sand_trial_realized
				clr_character_flag = poison_trial_realized
				clr_character_flag = dragon_snow_level_1
				clr_character_flag = dragon_snow_level_2
				clr_character_flag = dragon_snow_level_3
				clr_character_flag = dragon_snow_level_4
				clr_character_flag = dragon_fire_level_1
				clr_character_flag = dragon_fire_level_2
				clr_character_flag = dragon_fire_level_3
				clr_character_flag = dragon_fire_level_4
				clr_character_flag = dragon_water_level_1
				clr_character_flag = dragon_water_level_2
				clr_character_flag = dragon_water_level_3
				clr_character_flag = dragon_water_level_4
				clr_character_flag = dragon_sand_level_1
				clr_character_flag = dragon_sand_level_2
				clr_character_flag = dragon_sand_level_3
				clr_character_flag = dragon_sand_level_4
				clr_character_flag = dragon_poison_level_1
				clr_character_flag = dragon_poison_level_2
				clr_character_flag = dragon_poison_level_3
				clr_character_flag = dragon_poison_level_4
            }
        }
    }
}

# event 219
character_event = {
    id = ani_plus.219

    border = GFX_event_normal_frame_diplomacy
	picture = GFX_evt_council

	desc = DESC_ANI_219

    culture = dragon_culture
    trigger = {
        culture = dragon_culture
    }

    mean_time_to_happen = {
        years = 16 # 1 chance out of 2 to die

        modifier = { # or delayed if hospital has incubator
            factor = 5
            location = {
                hospital_has_building = ho_drg_incubator
            }
        }
    }

    option = {
        name = OPT_ANI_219

        death = {
            reason = death_childbirth
        }

        if = {
            limit = {
                father = {
                    ai = no
                }
            }

            father = {
                character_event = { id = ani_plus.220}
            }
        }
        if = {
            limit = {
                mother = {
                    ai = no
                }
            }

            mother = {
                character_event = { id = ani_plus.220}
            }
        }
    }
}

# event 220
character_event = {
    id = ani_plus.220

    is_triggered_only = yes
    border = GFX_event_normal_frame_diplomacy
	picture = GFX_evt_council

	desc = DESCA_ANI_220

    desc = {
        text = DESCB_ANI_220
        trigger = {
            FROM = {
                location = {
                    hospital_has_building = ho_drg_incubator
                }
            }
        }
    }

    option = {
        name = OPTA_ANI_220
        
        FROM = {}
    }

    option = {
        name = OPTB_ANI_220

        FROM = {}
        add_artifact = dragon_egg_artifact
    }
}