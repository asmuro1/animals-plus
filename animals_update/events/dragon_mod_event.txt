#######dragon update
### event 198 - 

namespace = ani_plus

#### event 198 and 199 are created to prevent dragon character from changing culture
#### at the exception where an egg can become an adult
## event 198: on_action trigger, switch back to old culture if old is dragon
## event 199: exits only to avoid an infinite loop if old and new culture are both adult dragon

# event 198 - preventing dragon to change culture (race)
character_event = {
    id = ani_plus.198

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_character_flag = ignore_next_dragon_conv }
    }

    immediate = {
        # had to do tests with a new character becaus engine did not let me do
        # any test on culture scope
        create_character = {
            culture = FROM
            female = random
        }

        if = {
            limit = {
                new_character = {
                    culture_group = dragon_group
                }
                NAND = {
                    new_character = {
                        culture = dragon_culture
                    }
                    ROOT = {
                        culture_group = dragon_group
                    }
                }
            }
            set_character_flag = ignore_next_dragon_conv
            culture = FROM

            character_event = { id = ani_plus.199 days = 1}
        }

        new_character = {
            death = yes
        }
    }
}

# event 199
character_event = {
    id = ani_plus.199

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        clr_character_flag = ignore_next_dragon_conv
    }
}

#### event 200 to 201: religious event force religion setting
## event 200: setting holy site randomly (on game start, event if random always choose the same provinces)
## event 201: forcing religion on dragon characters and dragon provinces at start
## event 202: converting character on birth or culture change
## event 203: converting province culture on religion change


# event 200
character_event = {
    id = ani_plus.200

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NOT = { has_global_flag = dragon_holy_sites_set }
    }

    immediate = {
        set_black_dragon_holy_site_effect = yes
        set_white_dragon_holy_site_effect = yes
        set_red_dragon_holy_site_effect = yes
        set_blue_dragon_holy_site_effect = yes
        set_yellow_dragon_holy_site_effect = yes
    }

    after = {
        set_global_flag = dragon_holy_sites_set
    }
}

# event 201
character_event = {
    id = ani_plus.201

    hide_window = yes
    is_triggered_only = yes

    immediate = {
        any_character = {
            limit = {
                culture_group = dragon_group
                can_change_religion = yes
            }
            religion = Dragon_religion
        }
        any_province = {
            limit = {
                culture_group = dragon_group
            }
            religion = Dragon_religion
        }
    }
}

# event 202
character_event = {
    id = ani_plus.202

    hide_window = yes
    is_triggered_only = yes

    trigger = {
        culture_group = dragon_group
        can_change_religion = yes
        NOT = { religion = Dragon_religion }
    }

    immediate = {
        religion = Dragon_religion
    }
}

# event 203
province_event = {
    id = ani_plus.203

    hide_window = yes
    
    trigger = {
        culture_group = dragon_group
        NOT = {
            religion = Dragon_religion
        }
    }

    mean_time_to_happen = {
        months = 1
    }

    immediate = {
        if = {
            limit = {
                holder_scope = {
                    culture_group = dragon_group
                }
            }

            religion = Dragon_religion
        }
        else = {
            culture = holder_scope
        }
    }
}