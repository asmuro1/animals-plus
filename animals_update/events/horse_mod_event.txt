namespace = ani_plus

###### horse update event
### event 170 - ?

## conversion quest
# event 170: event to launch quest by event rule
# event 171: removing quest cooldown
# event 172: finished the preparation
#       can lead to event 173: everything went well
#       can lead to event 174: unknown illness due to an hypnotic state
#       can lead to event 175: an accident occure
# event 173: everything went well
# event 174: remain unconcious for some days, need regent, lead to event 176
# event 175:
# event 176: woke up as an horse

# event 170
province_event = {
    id = ani_plus.170

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    trigger = {
        has_game_rule = {
            name = animals_conversion_ways
            value = animal_events
        }
        Is_really_animal_trigger = no
        holder_scope = {
            Is_really_animal_trigger = no
            OR = {
                lifestyle_traits == 0
                trait = hunter
            }
            is_nomadic = no
            wealth = 35
        }
        terrain = steppe
        NOT = { has_province_flag = horse_conv_quest_CD }
        OR = {
            has_building = tb_steppe_barracks_1
            has_building = tb_steppe_stable_1
            has_building = ca_steppe_stable_1
            has_building = ca_steppe_barracks_1
            has_building = tb_default_horse_conv_quest
            has_building = ca_default_horse_conv_quest
        }
    }

    mean_time_to_happen = {
        years = 200

        modifier = {
            factor = 0.25  # 50 years for players
            holder_scope = { ai = no }
        }
    }

    desc = DESC_ani_170

    immediate = {
        set_province_flag = horse_conv_quest_CD
    }

    option = {
        name = OPTA_ani_170
        FROM = {
            wealth = -35
            piety = -100
        }

        province_event = { id = ani_plus.172 days = 7 random = 7 }
    }
    option = {
        name = OPTB_ani_170
    }
    
    after = {
        province_event = { id = ani_plus.171 years = 10 }
    }
}

# event 171
province_event = {
    id = ani_plus.171
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        remove_province_modifier = horse_conv_quest_CD
    }
}

# event 172
province_event = {
    id = ani_plus.172

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    is_triggered_only = yes

    desc = DESC_ani_172

    option = {
        name = OPT_ani_172

        random_list = {
            2 = {
                custom_tooltip = {
                    text = TT_ani_172_went_well

                    province_event = { id = ani_plus.173 days = 5 random = 2 }
                }
            }
            3 = {
                custom_tooltip = {
                    text = TT_ani_172_went_wrong

                    random_list = {
                        2 =  { 
                            province_event = { id = ani_plus.174 days = 1 random = 6}
                        }
                        1 =  { 
                            province_event = { id = ani_plus.175 days = 1 random = 6}
                        }
                    }
                }
            }
        }
    }
}

# event 173
province_event = {
    id = ani_plus.173

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    is_triggered_only = yes

    desc = DESC_ani_173

    option = {
        name = OPT_ani_173

        holder_scope = {
            prestige = 350
            piety = 75
        }
        change_random_civ_tech = 1
    }
}

# event 174
province_event = {
    id = ani_plus.174

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    is_triggered_only = yes

    desc = DESC_ani_174

    option = {
        name = OPT_ani_174

        holder_scope = {
            prestige = -150
            add_trait = trait_unconcious
            character_event = { id = ani_plus.176 days = 1 random = 60 }
        }
    }
}

# event 175
province_event = {
    id = ani_plus.175

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    is_triggered_only = yes
}

# event 176
character_event = {
    id = ani_plus.176

    border = GFX_event_normal_frame_diplomacy
    picture = GFX_evt_council

    is_triggered_only = yes

    desc = DESC_ani_176

    option = {
        name = OPT_ani_176

        remove_trait = trait_unconcious
        culture = horse
    }
}